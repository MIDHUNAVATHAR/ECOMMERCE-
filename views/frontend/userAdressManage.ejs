<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Address Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

</head>
<body class="bg-black">

    
  <!-- Header --> 
  <%- include("partials/header") %>  


    <!--breadcrumb-->
    <nav class="text-sm mb-4 pl-10 pt-5" aria-label="Breadcrumb">
        <ol class="list-reset inline-flex items-center space-x-2">
            <li>
                <a href="/" class="text-white hover:text-gray-500">Home</a>
            </li>
            <li>
                <span class="text-white">/</span>
            </li>
            <li class="text-white">
                <a href="/userProfile" class="text-white hover:text-gray-500">My Account</a>
            </li>
        </ol>
    </nav>
    <!--breadcrumb-->



    <div class="container mx-auto p-4">
        <div class="bg-white shadow-md rounded-lg p-6">
            <div class="flex items-center mb-6">
               
                <svg class="w-8 h-8 text-gray-600 hover:text-gray-900" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 0c-4.97 0-9 4.03-9 9v1h18v-1c0-4.97-4.03-9-9-9z"></path>
                </svg>
                <h2  class="text-2xl font-semibold ml-4"> Hello </h2>
            </div>

            <div class="flex flex-col lg:flex-row gap-4">

              
             <!-- Sidebar -->
                <aside class="w-full lg:w-1/4 bg-gray-200 rounded-lg p-4">
                    <nav class="space-y-4">
                        <a href="/myOrders" class="block text-blue-600 font-semibold">MY ORDERS</a>
                        <div>
                            <h3 class="font-semibold">ACCOUNT SETTINGS</h3>
                            <ul class="mt-2 space-y-2">
                                <li><a href="/userProfile" class="text-gray-700">Profile Information</a></li>
                                <li><a href="/userAdressMang" class="text-gray-700">Manage Addresses</a></li>
                                <li><a href="/orderReturns" class="text-gray-700">Order Returns</a></li>
                                <li><a href="/walletHistory" class="text-gray-700">Wallet History</a></li>
                                <li><a href="/getCoupons" class="text-gray-700">Coupons</a></li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="font-semibold">WALLET BALANCE</h3>
                            <ul class="mt-2 space-y-2">
                                <li><a href="#" class="text-gray-700">₹  <%= user.walletBalance %></a></li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="font-semibold">REFERRAL BALANCE</h3> 
                            <ul class="mt-2 space-y-2">
                                <li><a href="#" class="text-gray-700">₹ <%= user.rewardsBalance %></a></li>
                            </ul>
                            <button  id="withdraw-ref-bln" class="bg-blue-500 text-white px-4 my-2 rounded hover:bg-blue-600">Withdraw</button>
                        </div>
                        <p class="text-indigo-900">My Referral Link  :</p>
                        <div class="flex items-center gap-2  ">
                          
                             
                            <p class="refLink text-blue-600"></p>
                        
                         <button onclick="copyText(this.value)" value="" class="refLink relative inline-flex items-centerp-2 rounded bg-transparent hover:bg-gray-100/10 transition-all duration-200">
                            <span id="copyIcon" class="text-gray-500">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                            </span>  
                            <span id="copiedMessage" class="hidden absolute -top-8 left-1/2 transform -translate-x-1/2 bg-black text-white text-sm px-2 py-1 rounded">
                                Copied!
                            </span>  
                        </button>
                        
                        </div>
                        <p class="text-gray-700">Send this referal link to Others . You will get Rs : 19 for each New Users</p>
                    </nav>




                   
                    

                    <div style="margin-top : 180px ;" > 
                        <a href="/userLogout" class="bg-gray-900 text-white font-bold py-2 px-4  rounded">
                            Logout
                        </a>
                    </div>

                </aside>

                <!-- Main Content -->
                <main class="w-full lg:w-3/4 bg-white rounded-lg p-4">
 
                    <div class="p-6 bg-white rounded-lg shadow-md">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Manage Addresses</h2>
                    
                        <div class="mb-6">
                            <button id="toggleFormBtn" class="text-blue-600 font-semibold hover:underline">
                                + ADD A NEW ADDRESS 
                            </button>
                        </div>


                        <!--submit form-->
                        <form id="addressForm" action="/saveAddress" method="POST" class="space-y-4 hidden">
                            
                            <input type="hidden" name="userId"  value="<%= user._id %>">
                            <input type="hidden" name="checkout" value="1" >
                             
                            <div>
                                <label for="name" class="block text-gray-700 font-medium"> Name </label>
                                <input type="text" name="name" id="name" class="mt-1 block w-full border border-gray-300 rounded-md p-2" required>
                            </div>

                            <div>
                                <label for="phone" class="block text-gray-700 font-medium"> Phone </label>
                                <input type="text" name="phone" id="phone" class="mt-1 block w-full border border-gray-300 rounded-md p-2" required>
                            </div>

                            <div>
                                <label for="alternatephone" class="block text-gray-700 font-medium">Alternate Phone</label>
                                <input type="text" name="alternatephone" id="alternatephone" class="mt-1 block w-full border border-gray-300 rounded-md p-2">
                            </div>

                            <div>
                                <label for="address" class="block text-gray-700 font-medium">Address</label>
                                <textarea name="address" id="address" class="mt-1 block w-full border border-gray-300 rounded-md p-2" required></textarea>
                            </div>

                            <div>
                                <label for="landmark" class="block text-gray-700 font-medium">Landmark</label>
                                <input type="text" name="landmark" id="landmark" class="mt-1 block w-full border border-gray-300 rounded-md p-2">
                            </div>

                            <div>
                                <label for="city" class="block text-gray-700 font-medium">City</label>
                                <input type="text" name="city" id="city" class="mt-1 block w-full border border-gray-300 rounded-md p-2" required>
                            </div>

                            <div>
                                <label for="state" class="block text-gray-700 font-medium">State</label>
                                <input type="text" name="state" id="state" class="mt-1 block w-full border border-gray-300 rounded-md p-2" required>
                            </div>

                            <div>
                                <label for="pincode" class="block text-gray-700 font-medium">Pincode</label>
                                <input type="text" name="pincode" id="pincode" class="mt-1 block w-full border border-gray-300 rounded-md p-2" required>
                            </div>

                            <div>
                                <label for="addressType" class="block text-gray-700 font-medium">Address Type</label>
                                <select name="addresstype" id="addressType" class="mt-1 block w-full border border-gray-300 rounded-md p-2" required>
                                    <option value="home">Home</option>
                                    <option value="work">Work</option>
                                </select>
                            </div>

                            <div class="text-right">
                                <button type="submit" class="px-4 py-2 mt-10 mb-10 bg-blue-600 text-white font-semibold rounded hover:bg-blue-700">Save</button>
                            </div>
                        </form>
                        <!---..........--> 
                    
                        <% addresses.forEach((address) => { %>
                            <div class="border border-gray-200 rounded-lg mb-4 p-4">
                               
                                <div class="flex justify-between items-start">
                                    <div class="flex items-center mb-2">
                                        <span class="px-2 py-1 bg-gray-200 text-gray-700 text-xs font-semibold rounded"> 
                                            <% if (address.addresstype === 'work') { %>
                                                WORK
                                            <% } else { %>
                                                HOME
                                            <% } %>
                                         </span>
                                        <div class="ml-3">
                                            <h3 class="text-lg font-semibold text-gray-800"><%= address.name %></h3>
                                            <p class="text-sm text-gray-600"><%= address.phone %></p>
                                        </div>
                                    </div>
                    
                                    <div class="relative">
                                        <button class="editDeleteBtn text-gray-600 hover:text-gray-800 focus:outline-none" > 
                                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> 
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 12h12m-6-6v12"></path>
                                            </svg>
                                        </button>
                    
                                        <div class=" togglerEditDelete absolute right-0 mt-2 w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-10 hidden  group-hover:block">
                                            <ul>
                                                <li>
                                                    <a class="addressEditBtn block px-4 py-2 text-gray-800 hover:bg-gray-100">
                                                        Edit
                                                    </a>
                                                </li>
                                                <li>
                                                    <a href="#" onclick="showDeleteConfirmation('<%= address.id %>')"  class="block px-4 py-2 text-gray-800 hover:bg-gray-100">
                                                        Delete
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                   
                                        
                                        
                                     
                                    </div>
                                </div>
                    
                                <p class="text-sm text-gray-600">
                                    <%= address.address %>, <%= address.landmark %>, <%= address.city %>, <%= address.state %> - <span class="font-semibold"><%= address.pincode %></span>
                                </p>
                            
                            
                            <!--Edit Form-->
                           
                                <form id="" action="/saveEditAddress/<%=address.id %>" method="POST" class="editAddressForm space-y-4 hidden">
                            
                                    <!-- <input type="hidden" name=""  value="<%= user._id %>"> -->
                                     
                                    <div>
                                        <label for="name" class="block text-gray-700 font-medium">Name</label>
                                        <input type="text" value="<%= address.name %>" name="name" id="name" class="mt-1 block w-full border border-gray-300 rounded-md p-2" required>
                                    </div>
        
                                    <div>
                                        <label for="phone" class="block text-gray-700 font-medium">Phone</label>
                                        <input type="text" value='<%=address.phone %>' name="phone" id="phone" class="mt-1 block w-full border border-gray-300 rounded-md p-2" required>
                                    </div>
        
                                    <div>
                                        <label for="alternatephone" class="block text-gray-700 font-medium">Alternate Phone</label>
                                        <input type="text" value="<%= address.alternatePhone %>" name="alternatephone" id="alternatephone" class="mt-1 block w-full border border-gray-300 rounded-md p-2">
                                    </div>
        
                                    <div>
                                        <label for="address" class="block text-gray-700 font-medium">Address</label>
                                        <textarea name="address"  id="address" class="mt-1 block w-full border border-gray-300 rounded-md p-2" required> <%= address.address %> </textarea>
                                    </div>
        
                                    <div>
                                        <label for="landmark" class="block text-gray-700 font-medium">Landmark</label>
                                        <input type="text" value="<%= address.landmark %>" name="landmark" id="landmark" class="mt-1 block w-full border border-gray-300 rounded-md p-2">
                                    </div>
        
                                    <div>
                                        <label for="city" class="block text-gray-700 font-medium">City</label>
                                        <input type="text" value="<%= address.city %>" name="city" id="city" class="mt-1 block w-full border border-gray-300 rounded-md p-2" required>
                                    </div>
        
                                    <div>
                                        <label for="state" class="block text-gray-700 font-medium">State</label>
                                        <input type="text" value="<%= address.state %>" name="state" id="state" class="mt-1 block w-full border border-gray-300 rounded-md p-2" required>
                                    </div>
        
                                    <div>
                                        <label for="pincode" class="block text-gray-700 font-medium">Pincode</label>
                                        <input type="text" value="<%= address.pincode %>
                                        " name="pincode" id="pincode" class="mt-1 block w-full border border-gray-300 rounded-md p-2" required>
                                    </div>

                                    <input type="hidden" name="checkout" value='0' >  
        
                                    <div>
                                        <label for="addressType" class="block text-gray-700 font-medium">Address Type</label>
                                        <select name="addresstype" id="addressType" class="mt-1 block w-full border border-gray-300 rounded-md p-2" required>
                                            <option value="home" <%= address.addresstype === 'home' ? 'selected' : '' %> >Home</option>
                                            <option value="work" <%= address.addresstype === 'work' ? 'selected' : '' %> >Work</option>
                                        </select>
                                    </div>
        
                                    <div class="text-right">
                                        <button type="submit" class="px-4 py-2 mt-10 mb-10 bg-blue-600 text-white font-semibold rounded hover:bg-blue-700">Save Changes</button>
                                    </div>

                                </form>
                            </div>
                        <% }); %>
                    </div>
                    

                </main>
            </div>
        </div>
    </div>

     <!-- Footer -->
     <%- include("partials/footer") %>

     <!-- Delete Confirmation Modal -->
     <div id="deleteModal" class="fixed z-10 inset-0 overflow-y-auto hidden">
         <div class="flex items-center justify-center min-h-screen">
             <div class="bg-blue-500 rounded-lg shadow-lg w-full max-w-md p-6">
                 <h3 class="text-lg font-medium text-white mb-4">Confirm Delete</h3> 
                 <p class="text-white mb-6">Are you sure you want to delete this address?</p> 
                 <div class="flex justify-end">
                     <button class="mr-2 px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300" onclick="hideDeleteConfirmation()">
                         Cancel
                     </button>
                     <a href="#" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"> 
                         Delete
                     </a>
                 </div>
             </div>
         </div>
     </div>



     <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>  

    <script>
       
      
  //toggle the form input 
        document.getElementById("toggleFormBtn").addEventListener("click" , function(){
              document.getElementById("addressForm").classList.toggle("hidden") ;
        })
      


        for( let i = 0 ; i < '<%=addresses.length %>'  ; i++ ){
           document.getElementsByClassName("editDeleteBtn")[i].addEventListener("click" , function(){
               document.getElementsByClassName("togglerEditDelete")[i].classList.toggle("hidden") ;

           })
        }
    
    //delete modal
    function showDeleteConfirmation(addressId) {
        const deleteModal = document.getElementById('deleteModal');
        deleteModal.classList.remove('hidden');
        deleteModal.querySelector('a').href = `/deleteAddress/${addressId}`;
    }

    function hideDeleteConfirmation() {
        const deleteModal = document.getElementById('deleteModal'); 
        deleteModal.classList.add('hidden');
    }

    //toggle edit form    
    for( let i = 0 ; i < '<%=addresses.length %>'  ; i++ ){
       
       document.getElementsByClassName("addressEditBtn")[i].addEventListener("click" , function(){
       document.getElementsByClassName("editAddressForm")[i].classList.toggle("hidden");
        document.getElementsByClassName("togglerEditDelete")[i].classList.toggle("hidden") ;

       })
    }




    function copyText(text) {
    // Copy the text
    navigator.clipboard.writeText(text);
    
    // Show the copied message
    const message = document.getElementById('copiedMessage');
    const copyIcon = document.getElementById('copyIcon');
    
    // Change icon to checkmark
    copyIcon.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-500">
            <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
    `;
    
    // Show message
    message.classList.remove('hidden');
    
    // Hide message and restore icon after 2 seconds
    setTimeout(() => {
        message.classList.add('hidden');
        copyIcon.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
        `;
    }, 2000);
}




//copy referal link

const referralCode = '<%= user.referralCode %>' ;

const url = new URL(window.location.href);

const referalLink = url.origin  +  '/userSignup' + `?referral=${referralCode}`
   
const ref = document.querySelectorAll(".refLink") ; 
ref[0].textContent = referalLink ;
ref[1].value = referalLink ;


   
    
    </script>

</body>
</html>
